services:
  rag-openclaw:
    container_name: rag-openclaw
    build: .
    image: hosteurdkuser/rag-openclaw:v0.7.0
    init: true
    env_file: .env
    environment:
      - BROWSER=echo
      - HOME=/home/agent
      - TERM=xterm-256color
    volumes:
      - openclaw-state:/home/agent/.openclaw
      - ./workspace:/home/agent/workspace
      - repos:/home/agent/repos
      - ./.ssh-agent:/home/agent/.ssh:ro
    ports:
      - "18789:18789"
      - "18790:18790"
    stdin_open: true
    tty: true
    restart: unless-stopped

  openclaw-cli:
    container_name: openclaw-cli
    image: hosteurdkuser/rag-openclaw:v0.7.0
    init: true
    env_file: .env
    environment:
      - BROWSER=echo
    volumes:
      - openclaw-state:/home/agent/.openclaw
      - ./workspace:/home/agent/workspace
      - repos:/home/agent/repos
      - ./.ssh-agent:/home/agent/.ssh:ro
    stdin_open: true
    tty: true
    entrypoint: ["node", "/app/dist/index.js"]
    profiles:
      - cli

  cloudflared:
    container_name: cloudflared
    image: cloudflare/cloudflared:latest
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
    depends_on:
      - rag-openclaw

volumes:
  openclaw-state:
  repos:
